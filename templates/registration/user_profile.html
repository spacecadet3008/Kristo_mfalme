{% extends 'base.html' %}

{% block title %}My Profile - {{ user_profile.username }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-4">
            <!-- Profile Card -->
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <!-- Avatar/Initials -->
                    <div class="mb-3">
                        <div class="avatar-circle" style="
                            width: 120px;
                            height: 120px;
                            background: linear-gradient(45deg, #3498db, #2c3e50);
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            margin: 0 auto;
                            color: white;
                            font-size: 3rem;
                            font-weight: bold;
                        ">
                            {{ user.firstname|first|upper }}{{ user.lastname|first|upper }}
                        </div>
                    </div>
                    
                    <h4 class="mb-1">{{ user.full_name }}</h4>
                    <p class="text-muted">@{{ user.username }}</p>
                    
                    <!-- Role Badge -->
                    <div class="mb-3">
                        <span class="badge 
                            {% if user.roles == 'admin' %}bg-danger
                            {% elif user.roles == 'Chairperson' %}bg-primary
                            {% elif user.roles == 'Secretary' %}bg-success
                            {% elif user.roles == 'Priest' %}bg-success
                            {% elif user.roles == 'Catechesis' %}bg-success
                            {% elif user.roles == 'Accountant' %}bg-warning
                            {% else %}bg-secondary{% endif %}
                            p-2">
                            {{ user_profile.get_roles_display }}
                        </span>
                    </div>
                    
                    <!-- Status Indicators -->
                    <div class="d-flex justify-content-center gap-3 mb-3">
                        <span class="status-indicator {% if user.is_active %}text-success{% else %}text-danger{% endif %}">
                            <i class="fas fa-circle me-1"></i>
                            {% if user.is_active %}Active{% else %}Inactive{% endif %}
                        </span>
                        
                        <span class="status-indicator {% if user.is_verified %}text-success{% else %}text-warning{% endif %}">
                            <i class="fas {% if user.is_verified %}fa-check-circle{% else %}fa-clock{% endif %} me-1"></i>
                            {% if user.is_verified %}Verified{% else %}Pending{% endif %}
                        </span>
                    </div>
                    
                    <!-- Staff Status -->
                    {% if user.is_staff %}
                    <div class="alert alert-info py-2">
                        <small><i class="fas fa-shield-alt me-1"></i> Staff Member</small>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="card shadow-sm mt-3">
                <div class="card-body">
                    <h6 class="card-title mb-3"><i class="fas fa-chart-line me-2"></i>Account Info</h6>
                    <div class="row text-center">
                        <div class="col-6 border-end">
                            <h5 class="mb-1">{{ user.date_joined|date:"M Y" }}</h5>
                            <small class="text-muted">Joined</small>
                        </div>
                        <div class="col-6">
                            <h5 class="mb-1">
                                {% if user.last_login %}
                                    {{ user.last_login|timesince }}
                                {% else %}
                                    Never
                                {% endif %}
                            </h5>
                            <small class="text-muted">Last Login</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-8">
            <!-- User Details Card -->
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="fas fa-user-circle me-2"></i>Personal Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Personal Details -->
                        <div class="col-md-6">
                            <h6 class="border-bottom pb-2 mb-3">Basic Details</h6>
                            <table class="table table-borderless">
                                <tr>
                                    <th width="40%">Username:</th>
                                    <td>{{ user.username }}</td>
                                </tr>
                                <tr>
                                    <th>Full Name:</th>
                                    <td>{{ user.full_name }}</td>
                                </tr>
                                <tr>
                                    <th>First Name:</th>
                                    <td>{{ user.firstname|default:"Not provided" }}</td>
                                </tr>
                                <tr>
                                    <th>Last Name:</th>
                                    <td>{{ user.lastname|default:"Not provided" }}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <!-- Contact Information -->
                        <div class="col-md-6">
                            <h6 class="border-bottom pb-2 mb-3">Contact Information</h6>
                            <table class="table table-borderless">
                                <tr>
                                    <th width="40%">Email:</th>
                                    <td>
                                        {{ user.email|default:"Not provided" }}
                                        {% if user.email %}
                                        <br><small class="text-muted">Primary contact email</small>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>Phone:</th>
                                    <td>{{ user.phone|default:"Not provided" }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Account Information Card -->
            <div class="card shadow-sm mt-3">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="fas fa-id-card me-2"></i>Account Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="50%">User Role:</th>
                                    <td>
                                        <span class="badge 
                                            {% if user.roles == 'admin' %}bg-danger
                                            {% elif user.roles == 'Chairperson' %}bg-primary
                                            {% elif user.roles == 'Secretary' %}bg-success
                                            {% elif user.roles == 'Accountant' %}bg-warning
                                            {% else %}bg-secondary{% endif %}">
                                            {{ user.get_roles_display }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Account Status:</th>
                                    <td>
                                        {% if user_profile.is_active %}
                                        <span class="badge bg-success">Active</span>
                                        {% else %}
                                        <span class="badge bg-danger">Inactive</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>Verification:</th>
                                    <td>
                                        {% if user.is_verified %}
                                        <span class="badge bg-success">Verified</span>
                                        {% else %}
                                        <span class="badge bg-warning">Pending Verification</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <th width="50%">Staff Status:</th>
                                    <td>
                                        {% if user.is_staff %}
                                        <span class="badge bg-primary">Staff Member</span>
                                        {% else %}
                                        <span class="badge bg-secondary">Regular User</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>Date Joined:</th>
                                    <td>{{ user.date_joined|date:"F d, Y" }}</td>
                                </tr>
                                <tr>
                                    <th>Password Status:</th>
                                    <td>
                                        {% if user.force_password_change %}
                                        <span class="badge bg-warning">
                                            <i class="fas fa-exclamation-triangle me-1"></i>Change Required
                                        </span>
                                        {% else %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-check me-1"></i>Up to Date
                                        </span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Additional Notes -->
                    <div class="alert alert-light mt-3">
                        <h6><i class="fas fa-info-circle me-2"></i>About This Account</h6>
                        <p class="mb-0">
                            This user account was created on {{ user.date_joined|date:"F d, Y" }}.
                            {% if user.is_active %}
                            The account is currently active and can access the system.
                            {% else %}
                            This account is currently inactive and cannot access the system.
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Security Alert if Password Change Required -->
            {% if user_profile.force_password_change and user_profile == request.user %}
            <div class="alert alert-warning mt-3">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-key fa-2x"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h5 class="alert-heading">Password Update Required</h5>
                        <p class="mb-0">You are required to change your password. Please update it from your account settings.</p>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>


      <div class="modal">
        <div class="modal-header">
          <h3 style="font-weight: 600">Logout</h3>
          <button class="close-modal" style="background: none; border: none; cursor: pointer">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <p>Do you want to logout?</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" id="cancelLogout">
            Cancel
          </button>
          <form method="post" action="{% url '_logout' %}" id="logoutForm" style="display: inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">
              Logout
            </button>
          </form>
        </div>
      </div>

<style>
    .card {
        border: 1px solid #e0e0e0;
        border-radius: 10px;
    }
    
    .card-header {
        border-bottom: 2px solid #f8f9fa;
        padding: 1rem 1.5rem;
    }
    
    .table-borderless td, .table-borderless th {
        border: none;
        padding: 8px 0;
    }
    
    .table-borderless th {
        font-weight: 600;
        color: #555;
        vertical-align: top;
    }
    
    .table-borderless tr:not(:last-child) td,
    .table-borderless tr:not(:last-child) th {
        border-bottom: 1px solid #f0f0f0;
    }
    
    .avatar-circle {
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transition: transform 0.3s ease;
    }
    
    .avatar-circle:hover {
        transform: scale(1.05);
    }
    
    .status-indicator {
        font-size: 0.9rem;
        display: inline-flex;
        align-items: center;
    }
    
    .badge {
        font-size: 0.8rem;
        font-weight: 500;
        padding: 0.4rem 0.8rem;
    }
    
    h6.border-bottom {
        color: #2c3e50;
        font-weight: 600;
    }
</style>
{% endblock %}