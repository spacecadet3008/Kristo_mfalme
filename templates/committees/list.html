{% extends 'base.html' %}

{% block content %}
<style>
    :root {
        --primary: #4f46e5;
        --bg: #f8fafc;
        --card-bg: #ffffff;
        --text-main: #1e293b;
        --text-muted: #64748b;
        --border: #e2e8f0;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .list-container {
        max-width: 1100px;
        margin: 2rem auto;
        padding: 0 1.5rem;
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2.5rem;
    }

    .page-header h1 {
        font-size: 1.75rem;
        color: var(--text-main);
        margin: 0;
    }

    /* Committee Card Styling */
    .committee-card {
        background: var(--card-bg);
        border-radius: 12px;
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
        margin-bottom: 2.5rem;
        overflow: hidden;
    }

    .card-header {
        background: #f1f5f9;
        padding: 1.5rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }

    .committee-title {
        font-size: 1.4rem;
        font-weight: 800;
        color: var(--primary);
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .committee-description {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin-top: 5px;
        font-style: italic;
    }

    /* Table Styling */
    .table-responsive {
        width: 100%;
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        text-align: left;
    }

    th {
        padding: 1rem 1.5rem;
        background: #fafafa;
        font-size: 0.8rem;
        text-transform: uppercase;
        color: var(--text-muted);
        font-weight: 700;
        border-bottom: 2px solid var(--border);
    }

    td {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #f1f5f9;
        font-size: 1rem;
        color: var(--text-main);
    }

    .position-badge {
        display: inline-block;
        background: #eef2ff;
        color: var(--primary);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .btn-edit {
        background: white;
        border: 1px solid var(--primary);
        color: var(--primary);
        padding: 0.5rem 1rem;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.85rem;
        transition: 0.2s;
    }

    .btn-edit:hover {
        background: var(--primary);
        color: white;
    }

    .btn-create {
        background: var(--primary);
        color: white;
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 700;
        box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3);
    }

    .empty-state {
        text-align: center;
        padding: 5rem;
        background: white;
        border-radius: 12px;
        border: 2px dashed var(--border);
    }
</style>

<div class="list-container">
    <div class="page-header">
        <h1>Committees & Boards</h1>
        <a href="{% url 'create_committee' %}" class="btn-create">+ New Committee</a>
    </div>

    <!-- REGROUP: Groups individual members by the Committee Name -->
    {% regroup committees by Commitee_name as committee_list %}

    {% for group in committee_list %}
    <div class="committee-card">
        <div class="card-header">
            <div>
                <!-- group.grouper displays the actual Committee Name -->
                <h2 class="committee-title">{{ group.grouper }}</h2>
                <div class="committee-description">
                    <!-- Access the description from the first member in the group -->
                    {{ group.list.0.description|default:"No description provided." }}
                </div>
            </div>
            <!-- Link to edit using the Committee Name string -->
            <a href="{% url 'edit_committee' group.grouper %}" class="btn-edit">
                Manage Group
            </a>
        </div>

        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Member Full Name</th>
                        <th>Position / Rank</th>
                        <th>Direct Phone</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Loop through all members assigned to THIS specific committee -->
                    {% for item in group.list %}
                    <tr>
                        <td style="font-weight: 600;">{{ item.member.name }}</td>
                        <td>
                            <span class="position-badge">
                                {{ item.get_position_display }}
                            </span>
                        </td>
                        <td>{{ item.phone|default:"---" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% empty %}
    <div class="empty-state">
        <p style="color: var(--text-muted); font-size: 1.1rem;">No active committees found in 2026.</p>
        <a href="{% url 'create_committee' %}" style="color: var(--primary); font-weight: 600;">Add the first one now â†’</a>
    </div>
    {% endfor %}
</div>

{% endblock %}
